# Baby Names Data Architecture

This directory implements a **Medallion Architecture (Bronze/Gold)** for managing baby name data with clear lineage, reproducibility, and version control.

## Directory Structure

```
data/
├── sources/              # BRONZE LAYER - Immutable source of truth
│   ├── ethnicity/       # Race/ethnicity probability data
│   │   ├── first_nameRaceProbs.csv (136k names, 7.4MB)
│   │   └── METADATA.yml
│   ├── nicknames/       # Nickname and diminutive mappings
│   │   ├── male_diminutives.csv (~150 names)
│   │   ├── female_diminutives.csv (~150 names)
│   │   └── METADATA.yml
│   └── popularity/      # Historical popularity trends
│       ├── hadley-baby-names.csv (1.9M records, 1880-2017)
│       └── METADATA.yml
│
├── snapshots/           # Point-in-time database backups (JSON)
│   └── backup_YYYYMMDD_HHMMSS/
│
└── backups/             # Legacy backup directory (deprecated)
```

## Data Layers

### Bronze Layer (`sources/`)
**Purpose**: Immutable source of truth
- Raw data files as downloaded from original sources
- Each source has METADATA.yml documenting provenance
- Version controlled in Git (or Git LFS for large files)
- Never modified after download

### Gold Layer (PostgreSQL)
**Purpose**: Operational serving layer
- Optimized for application queries
- Denormalized for performance
- Tables: `name_ethnicity_probabilities`, `name_nicknames`, etc.
- Populated via ETL scripts from Bronze layer

### Snapshots
**Purpose**: Point-in-time backups
- Full database exports to JSON
- Timestamped for recovery
- Generated by `scripts/export_all_data.py`
- Useful for rollback and disaster recovery

## Data Catalog

### 1. Ethnicity/Race Probabilities
**Source**: Harvard Dataverse
**File**: `sources/ethnicity/first_nameRaceProbs.csv`
**Records**: 136,000 first names
**Purpose**: Match names to user's cultural/ethnic background

**Schema**:
- `name`: First name (uppercase)
- `whi`, `bla`, `his`, `asi`, `oth`: Probability distributions (0-1)

**Usage**: Populate `name_ethnicity_probabilities` table
**Metadata**: See `sources/ethnicity/METADATA.yml`

### 2. Nicknames and Diminutives
**Source**: GitHub (carltonnorthern/nickname-and-diminutive-names-lookup)
**Files**:
- `sources/nicknames/male_diminutives.csv`
- `sources/nicknames/female_diminutives.csv`

**Records**: ~300 canonical names with 1-15 nicknames each
**Purpose**: Show naming flexibility and informal options

**Format**: `CanonicalName,Nick1,Nick2,...`
**Usage**: Populate `name_nicknames` table
**Metadata**: See `sources/nicknames/METADATA.yml`

### 3. Historical Popularity Data
**Source**: U.S. Social Security Administration (via Hadley Wickham)
**File**: `sources/popularity/hadley-baby-names.csv`
**Records**: 1.9 million (1880-2017)
**Purpose**: Show popularity trends over time

**Schema**:
- `year`: 1880-2017
- `sex`: M/F
- `name`: First name
- `n`: Count of babies
- `prop`: Proportion

**Usage**: Already imported to `popularity_trends` table
**Metadata**: See `sources/popularity/METADATA.yml`

## ETL Pipeline

### Quick Start - Full Rebuild
```bash
# One command to rebuild entire database from scratch
uv run python scripts/bootstrap.py
```

### Manual Steps
```bash
# 1. Extract: Verify source files (optional)
uv run python scripts/extract.py

# 2. Transform: Clean and validate (optional for this project)
# Data is clean enough to load directly

# 3. Load: Import to PostgreSQL
uv run python scripts/load_ethnicity.py
uv run python scripts/load_nicknames.py

# 4. Snapshot: Create backup
uv run python scripts/export_all_data.py
```

## Data Governance

### Versioning
- Bronze layer files are version controlled in Git
- Use Git tags for versioning: `git tag data-v2023-12`
- Large files (>50MB) should use Git LFS

### Updates
When new data sources become available:
1. Download to appropriate `sources/` directory
2. Update or create METADATA.yml
3. Update ETL scripts if schema changed
4. Run load script: `uv run python scripts/load_[source].py`
5. Create snapshot: `uv run python scripts/export_all_data.py`
6. Commit Bronze layer changes to Git

### Data Lineage
Each METADATA.yml documents:
- Original source and URL
- Download date and version
- Data schema and format
- Data quality notes
- Ethical considerations
- License and usage restrictions

### Reproducibility
Anyone can rebuild the entire database:
```bash
git clone [repo]
cd apps/backend
uv sync
uv run python scripts/bootstrap.py
```

This will:
1. Read all Bronze layer source files
2. Run migrations to create tables
3. Load all data into PostgreSQL
4. Generate statistics and reports

## Data Quality

### Validation
Each ETL script includes:
- Schema validation (expected columns)
- Data type checking
- Range validation (e.g., probabilities 0-1)
- Uniqueness constraints
- Foreign key validation

### Known Limitations

**Ethnicity Data**:
- Based on voter registration (older population)
- Six U.S. states only
- May not reflect current baby naming trends
- Limited to five demographic categories

**Nickname Data**:
- Primarily English-language nicknames
- ~300 names (not comprehensive)
- May miss cultural or regional variations
- Some diminutives may be outdated

**Popularity Data**:
- Only names with ≥5 occurrences per year
- Ends in 2017 (needs update)
- Binary sex classification only
- U.S. only

## Ethical Considerations

### Sensitive Data
This dataset includes demographic/racial data. Usage guidelines:
1. **Transparency**: Always show data source and limitations
2. **User Control**: Users opt-in to providing demographic info
3. **Purpose**: Help parents find culturally appropriate names
4. **No Discrimination**: Never use for hiring, lending, or discriminatory purposes
5. **Explanations**: Provide educational context for all metrics
6. **Aggregated Only**: Never expose individual-level data

### Bias Awareness
- Historical data reflects societal biases
- Demographic categories are social constructs
- Some names may have been affected by discrimination
- We document research on hiring bias to inform parents, not to perpetuate it

## Monitoring

### Data Freshness
- Ethnicity data: 2023
- Nickname data: 2018
- Popularity data: 2017

**Action**: Consider annual updates to popularity data

### Statistics
```bash
# Check current database statistics
uv run python scripts/check_statistics.py
```

Expected counts:
- Names: ~280,000
- Ethnicity records: ~136,000
- Nickname mappings: ~2,000
- Popularity trends: ~273,000

## References

### Data Sources
1. **Ethnicity Data**: Tzioumis, K. (2018). Demographic aspects of first names. Harvard Dataverse. https://doi.org/10.7910/DVN/TYJKEZ
2. **Nickname Data**: carltonnorthern/nickname-and-diminutive-names-lookup. GitHub. https://github.com/carltonnorthern/nickname-and-diminutive-names-lookup
3. **Popularity Data**: Hadley Wickham's babynames R package. GitHub. https://github.com/hadley/babynames

### Research Citations
- Bertrand, M., & Mullainathan, S. (2004). Are Emily and Greg More Employable Than Lakisha and Jamal? American Economic Review, 94(4), 991-1013.

## Future Data Sources

Potential additions documented in `DATA_STRATEGY.md`:
- NYC Open Data - Names by ethnic group
- Global name dataset (491M records)
- Name perception metrics (research-based)
- Regional popularity (state/city level)
- Surname compatibility analysis
